C51 COMPILER V9.52.0.0   TIM                                                               01/05/2025 16:12:05 PAGE 1   


C51 COMPILER V9.52.0.0, COMPILATION OF MODULE TIM
OBJECT MODULE PLACED IN tim.OBJ
COMPILER INVOKED BY: D:\por-tool\Keil\C51\BIN\C51.EXE tim.c BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          #include "tim.h"
   2          
   3          extern volatile u32 ulMs;
   4          void Led_Disp(u8 ucOut)
   5          {
   6   1        P0=~ucOut;
   7   1        P2=(P2 & 0x1F) | 0x80;
   8   1        P2=P2 & 0x1F;
   9   1      }
  10          
  11          void Cls_Waishe(void)
  12          {
  13   1        P0=0xFF;
  14   1        P2=(P2 & 0x1F) | 0x80;
  15   1        P2=P2 & 0x1F;
  16   1        P0=0x0;
  17   1        P2=(P2 & 0x1F) | 0xA0;
  18   1        P2=P2 & 0x1F;
  19   1      }
  20          
  21          void T1_Init(void)   //12T 12M
  22          {
  23   1        TH1=0xFC;
  24   1        TL1=0x18;
  25   1        TMOD &=0x0F;
  26   1        AUXR &=~(1<<6);
  27   1        TF1=0;
  28   1        ET1=1;
  29   1        EA=1;
  30   1        TR1=1;
  31   1      }
  32          void Delay(u16 usIn)
  33          {
  34   1        u32 ulInit;
  35   1        ulInit=ulMs;
  36   1        while(ulMs-ulInit<usIn);  
  37   1      }
  38          void Seg_Tran(u8 *pBuff,u8 *pCode)
  39          {
  40   1        u8 i,j;
  41   1        for(i=0,j=0;j<8;i++,j++)
  42   1        {
  43   2          switch(*(pBuff+i))
  44   2          {
  45   3            case '0':
  46   3              *(pCode+j)=0xc0;
  47   3              break;
  48   3            case '1':
  49   3              *(pCode+j)=0xf9;
  50   3              break;
  51   3            case '2':
  52   3              *(pCode+j)=0xa4;
  53   3              break;
  54   3            case '3':
  55   3              *(pCode+j)=0xb0;
C51 COMPILER V9.52.0.0   TIM                                                               01/05/2025 16:12:05 PAGE 2   

  56   3              break;
  57   3            case '4':
  58   3              *(pCode+j)=0x99;
  59   3              break;
  60   3            case '5':
  61   3              *(pCode+j)=0x92;
  62   3              break;
  63   3            case '6':
  64   3              *(pCode+j)=0x82;
  65   3              break;
  66   3            case '7':
  67   3              *(pCode+j)=0xf8;
  68   3              break;
  69   3            case '8':
  70   3              *(pCode+j)=0x80;
  71   3              break;
  72   3            case '9':
  73   3              *(pCode+j)=0x90;
  74   3              break;
  75   3            case 'A':
  76   3              *(pCode+j)=0x88;
  77   3              break;
  78   3            case 'B':
  79   3              *(pCode+j)=0x83;
  80   3              break;
  81   3            case 'C':
  82   3              *(pCode+j)=0xc6;
  83   3              break;
  84   3            case 'D':
  85   3              *(pCode+j)=0xa1;
  86   3              break;
  87   3            case 'E':
  88   3              *(pCode+j)=0x86;
  89   3              break;
  90   3            case 'F':
  91   3              *(pCode+j)=0x8e;
  92   3              break;
  93   3            case 'U':
  94   3              *(pCode+j)=0xc1;
  95   3              break;
  96   3            case 'P':
  97   3              *(pCode+j)=0x8c;
  98   3              break;
  99   3            case 'N':
 100   3              *(pCode+j)=0xab;
 101   3              break;
 102   3            case '-':
 103   3              *(pCode+j)=0xbf;
 104   3              break;
 105   3            case ' ':
 106   3              *(pCode+j)=0xff;
 107   3              break;
 108   3            case '.':
 109   3              j=j-1;
 110   3              *(pCode+j) &=0x7f;
 111   3              break;
 112   3            default:
 113   3              *(pCode+j)=0xff;        
 114   3          } 
 115   2        }
 116   1      }
 117          
C51 COMPILER V9.52.0.0   TIM                                                               01/05/2025 16:12:05 PAGE 3   

 118          void Seg_Disp(u8 *pCode,u8 ucPos)
 119          {
 120   1        P0=0xFF;
 121   1        P2=(P2 & 0x1F)|0xe0;
 122   1        P2 =P2 & 0x1F;
 123   1        P0=(u8)1<<ucPos;
 124   1        P2=(P2 & 0x1F)|0xc0;
 125   1        P2 =P2 & 0x1F;
 126   1        P0=*(pCode+ucPos);
 127   1        P2=(P2 & 0x1F)|0xe0;
 128   1        P2 =P2 & 0x1F;
 129   1      }
 130          
 131          u8 KBD_Read(void)
 132          {
 133   1        u16 uiArray1,uiArray2;
 134   1        u8 ucRtn=0;
 135   1        P44=0;P42=1;P35=1;P34=1;
 136   1        uiArray1=P3 & 0x0F;
 137   1        P44=1;P42=0;
 138   1        uiArray1=(uiArray1 <<4) | P3 & 0x0F;
 139   1        P42=1;P35=0;
 140   1        uiArray1=(uiArray1 <<4) | P3 & 0x0F;
 141   1        P35=1;P34=0;
 142   1        uiArray1=(uiArray1 <<4) | P3 & 0x0F;
 143   1        if(uiArray1==0xFFFF) return 0;
 144   1        Delay(10);
 145   1        P44=0;P42=1;P35=1;P34=1;
 146   1        uiArray2=P3 & 0x0F;
 147   1        P44=1;P42=0;
 148   1        uiArray2=(uiArray2 <<4) | P3 & 0x0F;
 149   1        P42=1;P35=0;
 150   1        uiArray2=(uiArray2 <<4) | P3 & 0x0F;
 151   1        P35=1;P34=0;
 152   1        uiArray2=(uiArray2 <<4) | P3 & 0x0F;
 153   1        if(uiArray1!=uiArray2) return 0;
 154   1        switch(~uiArray2)
 155   1        {
 156   2          case 0x8000:
 157   2            ucRtn=1;
 158   2            break;
 159   2          case 0x4000:
 160   2            ucRtn=2;
 161   2            break;
 162   2          case 0x2000:
 163   2            ucRtn=3;
 164   2            break;
 165   2          case 0x1000:
 166   2            ucRtn=4;
 167   2            break;
 168   2          case 0x0800:
 169   2            ucRtn=5;
 170   2            break;
 171   2          case 0x0400:
 172   2            ucRtn=6;
 173   2            break;
 174   2          case 0x0200:
 175   2            ucRtn=7;
 176   2            break;
 177   2          case 0x0100:
 178   2            ucRtn=8;
 179   2            break;
C51 COMPILER V9.52.0.0   TIM                                                               01/05/2025 16:12:05 PAGE 4   

 180   2          case 0x0080:    //S12
 181   2            ucRtn=9;
 182   2            break;
 183   2          case 0x0040:
 184   2            ucRtn=10;
 185   2            break;
 186   2          case 0x0020:
 187   2            ucRtn=11;
 188   2            break;
 189   2          case 0x0010:
 190   2            ucRtn=12;
 191   2            break;
 192   2          case 0x0008:    //S16
 193   2            ucRtn=13;
 194   2            break;
 195   2          case 0x0004:    //S17
 196   2            ucRtn=14;
 197   2            break;
 198   2          case 0x0002:
 199   2            ucRtn=15;
 200   2            break;
 201   2          case 0x0001:
 202   2            ucRtn=16;
 203   2            break;
 204   2          default:
 205   2            ucRtn=0;
 206   2        }
 207   1        return ucRtn;
 208   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1066    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----      15
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
