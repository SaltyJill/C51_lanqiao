C51 COMPILER V9.52.0.0   MAIN                                                              02/18/2024 09:35:15 PAGE 1   


C51 COMPILER V9.52.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: C:\Keil_C51_v5\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          #include "main.h"
   2          #include "tim.h"
   3          #include "onewire.h"
   4          #include "iic.h"
   5          #include "stdio.h"
   6          u8 ucLed=0;
   7          u8 ucState=0;
   8          u8 ucMode=0;
   9          
  10          u32 ulMs=0;
  11          //u32 ulMs10=0; 
  12          u16 usSec=0;
  13          u8 ucDac_Cnt=0,ucDac_Flag=0;
  14          u8 uc10ms_Cnt=0,uc10ms_Flag=0;
  15          //u16 uiSec_Cnt=0;
  16          //u8 ucSec_Flag=0;
  17          
  18          u8 pucSeg_Buff[10]="12345678",pucSeg_Code[8]={0},ucSeg_Pos=0;
  19          
  20          float fWd;  //defined in uart,used in  ds18b20
  21          u8 ucPara=25;
  22          u8 ucDac;
  23          
  24          
  25          
  26          
  27          void Key_Proc(void);
  28          void Seg_Proc(void);
  29          void Dac_Proc(void);
  30          void Wd_Proc(void);
  31          void Led_Proc(void);
  32          
  33          void main(void)
  34          {
  35   1        Cls_Waishe();
  36   1        T1_Init();
  37   1        
  38   1        while(1)
  39   1        {
  40   2          Key_Proc();
  41   2          
  42   2          Seg_Proc();
  43   2          
  44   2          Dac_Proc();
  45   2        
  46   2          Wd_Proc();
  47   2          Led_Proc();
  48   2        }
  49   1      }
  50          void Key_Proc(void)
  51          {
  52   1        static u8 ucKey_Old=0;
  53   1        u8 ucKey_Now;
  54   1        //ucKey_Now=KBD_Read();
  55   1        ucKey_Now=KBD_Read();
C51 COMPILER V9.52.0.0   MAIN                                                              02/18/2024 09:35:15 PAGE 2   

  56   1        if(ucKey_Now !=ucKey_Old)
  57   1        {
  58   2          switch(ucKey_Now)
  59   2          {
  60   3            //case 0:       
  61   3            //  break;
  62   3            case 1:   //S4
  63   3              ucState=(++ucState) % 3;   //why not ucState++
  64   3              
  65   3              break;
  66   3            case 2:   //S5
  67   3              ucMode=!ucMode;
  68   3              
  69   3              break;
  70   3            case 3:   //S6
  71   3              
  72   3              break;
  73   3            case 4:   //S7
  74   3              
  75   3              break;      
  76   3            case 5:   //S8
  77   3              if(ucState==1)
  78   3              {
  79   4                ucPara++;
  80   4                if(ucPara>99) ucPara=0;
  81   4              }
  82   3              break;    
  83   3            case 6:   //S9
  84   3              if(ucState==1)
  85   3              {
  86   4                if(!ucPara)
  87   4                {
  88   5                  ucPara=99;
  89   5                }
  90   4                else
  91   4                  ucPara--;
  92   4              }
  93   3              break;            
  94   3          }
  95   2          ucKey_Old=ucKey_Now;
  96   2        }
  97   1      }
  98          
  99          void Seg_Proc(void)
 100          {
 101   1        static u32 ulMs10Temp=0;    
 102   1        
 103   1        if(!uc10ms_Flag) return;
 104   1        uc10ms_Flag=0;
 105   1        //if(ulMs10Temp !=ulMs10)   //method 3
 106   1        //{
 107   1          //ulMs10Temp =ulMs10;
 108   1          if(!ucState)
 109   1          {
 110   2            sprintf(pucSeg_Buff, "C   %5.2f",fWd);  
 111   2          }
 112   1          else if(ucState==1)
 113   1          {
 114   2            sprintf(pucSeg_Buff, "P     %2u",(u16)ucPara);  
 115   2          }
 116   1          else
 117   1          {
C51 COMPILER V9.52.0.0   MAIN                                                              02/18/2024 09:35:15 PAGE 3   

 118   2            sprintf(pucSeg_Buff, "A    %4.2f",ucDac*5.0/255);
 119   2          }
 120   1          
 121   1          Seg_Tran(pucSeg_Buff,pucSeg_Code);  
 122   1        //}
 123   1      }
*** WARNING C280 IN LINE 101 OF main.c: 'ulMs10Temp': unreferenced local variable
 124          void ISR_T1() interrupt 3   //1ms
 125          {
 126   1        static u8 ucMsCnt=0;
 127   1        ulMs++;
 128   1        
 129   1        //if(ulMs % 10==0)   
 130   1        //  ulMs10++;
 131   1        if(++uc10ms_Cnt==100)
 132   1        {
 133   2          uc10ms_Cnt=0;
 134   2          uc10ms_Flag=1;
 135   2        }
 136   1        if(++ucDac_Cnt==100)
 137   1        {
 138   2          ucDac_Cnt=0;
 139   2          ucDac_Flag=1;
 140   2        }
 141   1        
 142   1        if(ulMs % 1000==0)
 143   1        {
 144   2          usSec++;      
 145   2        }
 146   1        /*if(++uiSec_Cnt==1000)
 147   1        {
 148   1          uiSec_Cnt=0;
 149   1          ucSec_Flag=1;
 150   1        }*/
 151   1        Seg_Disp(pucSeg_Code,ucSeg_Pos);
 152   1        if(++ucSeg_Pos==8) ucSeg_Pos=0;   
 153   1      }
*** WARNING C280 IN LINE 126 OF main.c: 'ucMsCnt': unreferenced local variable
 154          void Wd_Proc(void)
 155          { 
 156   1        static u32 ulStepBegin=0;
 157   1        static u8 ucStep=0;
 158   1        s16 sWd;
 159   1        
 160   1        switch(ucStep)
 161   1        {
 162   2          case 0:
 163   2            Wd_Convert();
 164   2            ulStepBegin=ulMs;
 165   2            ucStep=1;
 166   2            break;
 167   2          case 1:
 168   2            if(ulMs-ulStepBegin>960)    //760
 169   2            {       
 170   3              sWd=Wd_Read();
 171   3              fWd=sWd/16.0; 
 172   3              ulStepBegin=ulMs;
 173   3              ucStep=2;
 174   3            }
 175   2            break;
 176   2          case 2:     
 177   2              if(ulMs-ulStepBegin>5)    //100 »ò10
C51 COMPILER V9.52.0.0   MAIN                                                              02/18/2024 09:35:15 PAGE 4   

 178   2              {
 179   3                ucStep=0;
 180   3              } 
 181   2              break;
 182   2        }   
 183   1      }
 184          void Dac_Proc(void)
 185          {
 186   1          float fAdc;
 187   1          if(!ucDac_Flag) return;
 188   1          ucDac_Flag=0;
 189   1          if(!ucMode)
 190   1          {
 191   2            if( fWd < ucPara)
 192   2              ucDac=0;
 193   2            else
 194   2              ucDac=255;
 195   2          }
 196   1          else
 197   1          {
 198   2            if(fWd<20)
 199   2            {
 200   3              ucDac=1*255/5;
 201   3            }
 202   2            else if(fWd>40)
 203   2            {
 204   3              ucDac=4*255/5;
 205   3            }
 206   2            else
 207   2            {
 208   3              ucDac=((fWd-20)*3.0/20+1)*255/5;
 209   3            }
 210   2          }
 211   1          PCF8591_Dac(ucDac);
 212   1          //ucDac=PCF8591_Adc();    
 213   1          
 214   1      }
*** WARNING C280 IN LINE 186 OF main.c: 'fAdc': unreferenced local variable
 215          void Led_Proc(void)
 216          {
 217   1        if(!uc10ms_Flag) return;
 218   1        uc10ms_Flag=0;
 219   1        if(!ucMode)
 220   1          ucLed |=1;
 221   1        else
 222   1          ucLed &=1;
 223   1        ucLed &=~(7<<1);
 224   1        ucLed |=1<<(ucState+1);
 225   1        Led_Disp(ucLed);
 226   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    778    ----
   CONSTANT SIZE    =     31    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     49       4
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  3 WARNING(S),  0 ERROR(S)
