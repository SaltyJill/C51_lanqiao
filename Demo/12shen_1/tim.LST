C51 COMPILER V9.52.0.0   TIM                                                               02/18/2024 07:53:06 PAGE 1   


C51 COMPILER V9.52.0.0, COMPILATION OF MODULE TIM
OBJECT MODULE PLACED IN tim.OBJ
COMPILER INVOKED BY: C:\Keil_C51_v5\C51\BIN\C51.EXE tim.c BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          #include "tim.h"
   2          
   3          extern volatile u32 ulMs;
   4          void Led_Disp(u8 ucOut)
   5          {
   6   1        P0=~ucOut;
   7   1        P2=(P2 & 0x1F) | 0x80;
   8   1        P2=P2 & 0x1F;
   9   1      }
  10          
  11          void Cls_Waishe(void)
  12          {
  13   1        P0=0xFF;
  14   1        P2=(P2 & 0x1F) | 0x80;
  15   1        P2=P2 & 0x1F;
  16   1        P0=0x0;
  17   1        P2=(P2 & 0x1F) | 0xA0;
  18   1        P2=P2 & 0x1F;
  19   1      }
  20          
  21          void T1_Init(void)   //12T 12M
  22          {
  23   1        TH1=0xFC;
  24   1        TL1=0x18;
  25   1        TMOD &=0x0F;
  26   1        AUXR &=~(1<<6);
  27   1        TF1=0;
  28   1        ET1=1;
  29   1        EA=1;
  30   1        TR1=1;
  31   1      }
  32          void Delay(u16 usIn)
  33          {
  34   1        u32 ulInit;
  35   1        ulInit=ulMs;
  36   1        while(ulMs-ulInit<usIn);  
  37   1      }
  38          void Seg_Tran(u8 *pBuff,u8 *pCode)
  39          {
  40   1        u8 i,j;
  41   1        for(i=0,j=0;j<8;i++,j++)
  42   1        {
  43   2          switch(*(pBuff+i))
  44   2          {
  45   3            case '0':
  46   3              *(pCode+j)=0xc0;
  47   3              break;
  48   3            case '1':
  49   3              *(pCode+j)=0xf9;
  50   3              break;
  51   3            case '2':
  52   3              *(pCode+j)=0xa4;
  53   3              break;
  54   3            case '3':
  55   3              *(pCode+j)=0xb0;
C51 COMPILER V9.52.0.0   TIM                                                               02/18/2024 07:53:06 PAGE 2   

  56   3              break;
  57   3            case '4':
  58   3              *(pCode+j)=0x99;
  59   3              break;
  60   3            case '5':
  61   3              *(pCode+j)=0x92;
  62   3              break;
  63   3            case '6':
  64   3              *(pCode+j)=0x82;
  65   3              break;
  66   3            case '7':
  67   3              *(pCode+j)=0xf8;
  68   3              break;
  69   3            case '8':
  70   3              *(pCode+j)=0x80;
  71   3              break;
  72   3            case '9':
  73   3              *(pCode+j)=0x90;
  74   3              break;
  75   3            case 'A':
  76   3              *(pCode+j)=0x88;
  77   3              break;
  78   3            case 'B':
  79   3              *(pCode+j)=0x83;
  80   3              break;
  81   3            case 'C':
  82   3              *(pCode+j)=0xc6;
  83   3              break;
  84   3            case 'D':
  85   3              *(pCode+j)=0xa1;
  86   3              break;
  87   3            case 'E':
  88   3              *(pCode+j)=0x86;
  89   3              break;
  90   3            case 'F':
  91   3              *(pCode+j)=0x8e;
  92   3              break;
  93   3            case 'P':
  94   3              *(pCode+j)=0x8c;
  95   3              break;
  96   3            case '-':
  97   3              *(pCode+j)=0xbf;
  98   3              break;
  99   3            case ' ':
 100   3              *(pCode+j)=0xff;
 101   3              break;
 102   3            case '.':
 103   3              j=j-1;
 104   3              *(pCode+j) &=0x7f;
 105   3              break;
 106   3            default:
 107   3              *(pCode+j)=0xff;        
 108   3          } 
 109   2        }
 110   1      }
 111          void Seg_Disp(u8 *pCode,u8 ucPos)
 112          {
 113   1        P0=0xFF;
 114   1        P2=(P2 & 0x1F)|0xe0;
 115   1        P2 =P2 & 0x1F;
 116   1        P0=(u8)1<<ucPos;
 117   1        P2=(P2 & 0x1F)|0xc0;
C51 COMPILER V9.52.0.0   TIM                                                               02/18/2024 07:53:06 PAGE 3   

 118   1        P2 =P2 & 0x1F;
 119   1        P0=*(pCode+ucPos);
 120   1        P2=(P2 & 0x1F)|0xe0;
 121   1        P2 =P2 & 0x1F;
 122   1      }
 123          u8 KBD_Read(void)
 124          {
 125   1        u16 uiArray1,uiArray2;
 126   1        u8 ucRtn=0;
 127   1        //P44=0;P42=1;P35=1;P34=1;     P34 used as Pwm out,in Capture
 128   1        P44=0;P42=1;
 129   1        uiArray1=P3 & 0x0F;
 130   1        P44=1;P42=0;
 131   1        uiArray1=(uiArray1 <<4) | P3 & 0x0F;    
 132   1        if(uiArray1==0x00FF) return 0;
 133   1        Delay(10);
 134   1        //P44=0;P42=1;P35=1;P34=1;
 135   1        P44=0;P42=1;
 136   1        uiArray2=P3 & 0x0F;
 137   1        P44=1;P42=0;
 138   1        uiArray2=(uiArray2 <<4) | P3 & 0x0F;
 139   1        
 140   1        if(uiArray1!=uiArray2) return 0;
 141   1        switch(~uiArray1)
 142   1        {
 143   2          case 0xFF80:
 144   2            ucRtn=1;
 145   2            break;
 146   2          case 0xFF40:
 147   2            ucRtn=2;
 148   2            break;    
 149   2          case 0xFF20:
 150   2            ucRtn=3;
 151   2            break;    
 152   2          case 0xFF10:
 153   2            ucRtn=4;
 154   2            break;    
 155   2          case 0xFF08:
 156   2            ucRtn=5;
 157   2            break;
 158   2          case 0xFF04:
 159   2            ucRtn=6;
 160   2            break;    
 161   2          case 0xFF02:
 162   2            ucRtn=7;
 163   2            break;    
 164   2          case 0xFF01:
 165   2            ucRtn=8;
 166   2            break;    
 167   2          default:
 168   2            ucRtn=0;
 169   2        }
 170   1        return ucRtn;
 171   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    835    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----      15
C51 COMPILER V9.52.0.0   TIM                                                               02/18/2024 07:53:06 PAGE 4   

   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
