C51 COMPILER V9.52.0.0   TIM                                                               05/19/2024 07:06:51 PAGE 1   


C51 COMPILER V9.52.0.0, COMPILATION OF MODULE TIM
OBJECT MODULE PLACED IN tim.OBJ
COMPILER INVOKED BY: C:\Keil_C51_v5\C51\BIN\C51.EXE tim.c LARGE BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          #include "tim.h"
   2          
   3          extern volatile u32 ulMs;
   4          void Led_Disp(u8 ucOut)
   5          {
   6   1        P0=~ucOut;
   7   1        P2=(P2 & 0x1F) | 0x80;
   8   1        P2=P2 & 0x1F;
   9   1      }
  10          
  11          void Cls_Waishe(void)
  12          {
  13   1        P0=0xFF;
  14   1        P2=(P2 & 0x1F) | 0x80;
  15   1        P2=P2 & 0x1F;
  16   1        P0=0x0;
  17   1        P2=(P2 & 0x1F) | 0xA0;
  18   1        P2=P2 & 0x1F;
  19   1      }
  20          void Out_Waishe(u8 ucVal)
  21          {
  22   1        P0=ucVal;
  23   1        P2=(P2 & 0x1F) | 0xA0;
  24   1        P2=P2 & 0x1F;
  25   1      }
  26          void T1_Init(void)   //12T 12M
  27          {
  28   1        TH1=0xFC;
  29   1        TL1=0x18;
  30   1        TMOD &=0x0F;
  31   1        AUXR &=~(1<<6);
  32   1        TF1=0;
  33   1        ET1=1;
  34   1        EA=1;
  35   1        TR1=1;
  36   1      }
  37          /*
  38          void T0_Init(void)    //12T  @12.000MHz   ---P34 for Capture 
  39          {
  40            AUXR &= 0x7F;   //12T
  41            TMOD |= 0x04;   //mode 0
  42            TL0 = 0x00;   
  43            TH0 = 0x00;   
  44            TF0 = 0;    
  45            TR0 = 1;    
  46            //ET0=1;
  47            //EA=1;
  48          }*/
  49          void T0_Init(void)    //12T  @12.000MHz   ---for Wave P10,P11
  50          {
  51   1        AUXR &= 0x7F;   //12T
  52   1        TMOD &= 0xF0;   
  53   1        TL0 = 0x00;   
  54   1        TH0 = 0x00;   
  55   1        //TF0 = 0;    
C51 COMPILER V9.52.0.0   TIM                                                               05/19/2024 07:06:51 PAGE 2   

  56   1        TR0 = 0;    
  57   1      }
  58          void UartInit(void)   //19200bps@12.000MHz
  59          {
  60   1         SCON = 0x50; //????1
  61   1         AUXR |= 0x01;  //T2?????
  62   1         AUXR |= 0x04;      //1T
  63   1         T2L = 0x64;  
  64   1         T2H = 0xFF;  
  65   1         AUXR |= 0x10;      //TR2
  66   1         ES=1;
  67   1         EA=1;
  68   1      }
  69          void UartSend(u8 *str1)
  70          {
  71   1        u8 i=0;
  72   1        while(str1[i])
  73   1        {
  74   2          SBUF=str1[i];
  75   2          i++;
  76   2          while(!TI);
  77   2          TI=0;
  78   2        }
  79   1      }
  80          void Delay(u16 usIn)
  81          {
  82   1        u32 ulInit;
  83   1        ulInit=ulMs;
  84   1        while(ulMs-ulInit<usIn);  
  85   1      }
  86          void Seg_Tran(u8 *pBuff,u8 *pCode)
  87          {
  88   1        u8 i,j;
  89   1        for(i=0,j=0;j<8;i++,j++)
  90   1        {
  91   2          switch(*(pBuff+i))
  92   2          {
  93   3            case '0':
  94   3              *(pCode+j)=0xc0;
  95   3              break;
  96   3            case '1':
  97   3              *(pCode+j)=0xf9;
  98   3              break;
  99   3            case '2':
 100   3              *(pCode+j)=0xa4;
 101   3              break;
 102   3            case '3':
 103   3              *(pCode+j)=0xb0;
 104   3              break;
 105   3            case '4':
 106   3              *(pCode+j)=0x99;
 107   3              break;
 108   3            case '5':
 109   3              *(pCode+j)=0x92;
 110   3              break;
 111   3            case '6':
 112   3              *(pCode+j)=0x82;
 113   3              break;
 114   3            case '7':
 115   3              *(pCode+j)=0xf8;
 116   3              break;
 117   3            case '8':
C51 COMPILER V9.52.0.0   TIM                                                               05/19/2024 07:06:51 PAGE 3   

 118   3              *(pCode+j)=0x80;
 119   3              break;
 120   3            case '9':
 121   3              *(pCode+j)=0x90;
 122   3              break;
 123   3            case 'A':
 124   3              *(pCode+j)=0x88;
 125   3              break;
 126   3            case 'B':
 127   3              *(pCode+j)=0x83;
 128   3              break;
 129   3            case 'C':
 130   3              *(pCode+j)=0xc6;
 131   3              break;
 132   3            case 'D':
 133   3              *(pCode+j)=0xa1;
 134   3              break;
 135   3            case 'E':
 136   3              *(pCode+j)=0x86;
 137   3              break;
 138   3            case 'F':
 139   3              *(pCode+j)=0x8e;
 140   3              break;
 141   3            case '-':
 142   3              *(pCode+j)=0xbf;
 143   3              break;
 144   3            case ' ':
 145   3              *(pCode+j)=0xff;
 146   3              break;
 147   3            case '.':
 148   3              j=j-1;
 149   3              *(pCode+j) &=0x7f;
 150   3              break;
 151   3            case 'H':
 152   3              *(pCode+j)=0x89;
 153   3              break;
 154   3            case 'P':
 155   3              *(pCode+j)=0x8c;
 156   3              break;
 157   3            case 'L':
 158   3              *(pCode+j)=0xc7;
 159   3              break;
 160   3            default:
 161   3              *(pCode+j)=0xff;        
 162   3          } 
 163   2        }
 164   1      }
 165          void Seg_Disp(u8 *pCode,u8 ucPos)
 166          {
 167   1        P0=0xFF;
 168   1        P2=(P2 & 0x1F)|0xe0;
 169   1        P2 =P2 & 0x1F;
 170   1        P0=(u8)1<<ucPos;
 171   1        P2=(P2 & 0x1F)|0xc0;
 172   1        P2 =P2 & 0x1F;
 173   1        P0=*(pCode+ucPos);
 174   1        P2=(P2 & 0x1F)|0xe0;
 175   1        P2 =P2 & 0x1F;
 176   1      }
 177          u8 KBD_Read(void)
 178          {
 179   1        u16 uiArray1,uiArray2;
C51 COMPILER V9.52.0.0   TIM                                                               05/19/2024 07:06:51 PAGE 4   

 180   1        u8 ucRtn=0;
 181   1        //P44=0;P42=1;P35=1;P34=1;     P34 used as Pwm out,in Capture
 182   1        P44=0;P42=1;
 183   1        uiArray1=P3 & 0x0F;
 184   1        P44=1;P42=0;
 185   1        uiArray1=(uiArray1 <<4) | P3 & 0x0F;    
 186   1        if(uiArray1==0x00FF) return 0;
 187   1        Delay(10);
 188   1        //P44=0;P42=1;P35=1;P34=1;
 189   1        P44=0;P42=1;
 190   1        uiArray2=P3 & 0x0F;
 191   1        P44=1;P42=0;
 192   1        uiArray2=(uiArray2 <<4) | P3 & 0x0F;
 193   1        
 194   1        if(uiArray1!=uiArray2) return 0;
 195   1        switch(~uiArray1)
 196   1        {
 197   2          case 0xFF80:
 198   2            ucRtn=1;
 199   2            break;
 200   2          case 0xFF40:
 201   2            ucRtn=2;
 202   2            break;    
 203   2          case 0xFF20:
 204   2            ucRtn=3;
 205   2            break;    
 206   2          case 0xFF10:
 207   2            ucRtn=4;
 208   2            break;    
 209   2          case 0xFF08:
 210   2            ucRtn=5;
 211   2            break;
 212   2          case 0xFF04:
 213   2            ucRtn=6;
 214   2            break;    
 215   2          case 0xFF02:
 216   2            ucRtn=7;
 217   2            break;    
 218   2          case 0xFF01:
 219   2            ucRtn=8;
 220   2            break;    
 221   2          default:
 222   2            ucRtn=0;
 223   2        }
 224   1        return ucRtn;
 225   1      }
 226          u8 MaoPao_Filter(u8 *pucBuff,u8 ucLen)  
 227          {
 228   1        u8 i,j;
 229   1        u8 Temp;
 230   1        
 231   1        for(i=0;i<=ucLen-2;i++)    //ucLen/2
 232   1        {
 233   2          for(j=0;j<=ucLen-2-i ;j++)
 234   2          {
 235   3            if(pucBuff[j]>pucBuff[j+1])
 236   3            {
 237   4              Temp=pucBuff[j+1];
 238   4              pucBuff[j+1]=pucBuff[j];
 239   4              pucBuff[j]=Temp;
 240   4            }
 241   3          }
C51 COMPILER V9.52.0.0   TIM                                                               05/19/2024 07:06:51 PAGE 5   

 242   2        }
 243   1        Temp=pucBuff[ucLen/2];
 244   1        return Temp;
 245   1      }
 246          u8 ComPare_Filter(u8 *pucBuff,u8 ucLen) 
 247          {
 248   1        u8 i,j,Temp;
 249   1        for(i=0;i<=ucLen-2;i++)
 250   1        {
 251   2          for(j=i+1;j<=ucLen-1;j++)
 252   2          {
 253   3            if(pucBuff[i]>pucBuff[j])
 254   3            {
 255   4              Temp=pucBuff[i];
 256   4              pucBuff[i]=pucBuff[j];
 257   4              pucBuff[j]=Temp;
 258   4            }
 259   3          }
 260   2        }
 261   1        Temp=pucBuff[ucLen/2];
 262   1        return Temp;
 263   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1609    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----      32
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
