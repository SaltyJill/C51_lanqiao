C51 COMPILER V9.52.0.0   DS1302                                                            04/01/2025 15:32:09 PAGE 1   


C51 COMPILER V9.52.0.0, COMPILATION OF MODULE DS1302
OBJECT MODULE PLACED IN ds1302.OBJ
COMPILER INVOKED BY: D:\por-tool\Keil\C51\BIN\C51.EXE ds1302.c LARGE BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          /*  #   DS1302ä»£ç ç‰‡æ®µè¯´æ˜
   2              1.  æœ¬æ–‡ä»¶å¤¹ä¸­æä¾›çš„é©±åŠ¨ä»£ç ä¾›å‚èµ›é€‰æ‰‹å®Œæˆç¨‹åºè®¾è®¡å‚è€ƒã€‚
   3              2.  å‚èµ›é€‰æ‰‹å¯ä»¥è‡ªè¡Œç¼–å†™ç›¸å…³ä»£ç æˆ–ä»¥è¯¥ä»£ç ä¸ºåŸºç¡€ï¼Œæ ¹æ®æ‰€é€‰å•ç‰‡æœºç±»å‹ã€
             -è¿è¡Œé€Ÿåº¦å’Œè¯•é¢˜
   4                  ä¸­å¯¹å•ç‰‡æœºæ—¶é’Ÿé¢‘ç‡çš„è¦æ±‚ï¼Œè¿›è¡Œä»£ç è°ƒè¯•å’Œä¿®æ”¹ã€‚
   5          */
   6          
   7          // DS1302æ—¶é’ŸèŠ¯ç‰‡
   8          #include "ds1302.h"
   9          void Write_Ds1302(unsigned char temp)
  10          {
  11   1          unsigned char i;
  12   1          for (i = 0; i < 8; i++)
  13   1          {
  14   2              SCK = 0;
  15   2              SDA = temp & 0x01;
  16   2              temp >>= 1;
  17   2              SCK = 1;
  18   2          }
  19   1      }
  20          
  21          // DS1302 å†™å­—èŠ‚
  22          void Write_Ds1302_Byte(unsigned char address, unsigned char dat)
  23          {
  24   1          RST = 0;
  25   1          _nop_();
  26   1          SCK = 0;
  27   1          _nop_();
  28   1          RST = 1;
  29   1          _nop_();
  30   1          Write_Ds1302(address);
  31   1          Write_Ds1302(dat);
  32   1          RST = 0;
  33   1      }
  34          
  35          // DS1302 è¯»å­—èŠ‚
  36          unsigned char Read_Ds1302_Byte(unsigned char address)
  37          {
  38   1          unsigned char i, temp = 0x00;
  39   1          RST = 0;
  40   1          _nop_();
  41   1          SCK = 0;
  42   1          _nop_();
  43   1          RST = 1;
  44   1          _nop_();
  45   1          Write_Ds1302(address);
  46   1          for (i = 0; i < 8; i++)
  47   1          {
  48   2              SCK = 0;
  49   2              temp >>= 1;
  50   2              if (SDA)
  51   2                  temp |= 0x80;
  52   2              SCK = 1;
  53   2          }
  54   1          RST = 0;
C51 COMPILER V9.52.0.0   DS1302                                                            04/01/2025 15:32:09 PAGE 2   

  55   1          _nop_();
  56   1          SCK = 0;
  57   1          _nop_();
  58   1          SCK = 1;
  59   1          _nop_();
  60   1          SDA = 0;
  61   1          _nop_();
  62   1          SDA = 1;
  63   1          _nop_();
  64   1          return (temp);
  65   1      }
  66          /*user code here*/
  67          void DS1302_SET(u8 *ptime)
  68          {
  69   1          Write_Ds1302_Byte(0x8E, 0x00);
  70   1          Write_Ds1302_Byte(0x80, ptime[2] /10* 16 + ptime[2] % 10);
  71   1          Write_Ds1302_Byte(0x82, ptime[1] /10* 16 + ptime[1] % 10);
  72   1          Write_Ds1302_Byte(0x84, ptime[0] /10* 16 + ptime[0] % 10);
  73   1          Write_Ds1302_Byte(0x8E, 0x80);
  74   1      }
  75          void DS1302_RED(u8 *prdTime)
  76          {
  77   1          u8 tTime;
  78   1          tTime = Read_Ds1302_Byte(0x81);
  79   1          prdTime[2] = tTime /16*10 + tTime % 16;
  80   1          tTime = Read_Ds1302_Byte(0x83);
  81   1          prdTime[1] = tTime /16*10 + tTime % 16;
  82   1          tTime = Read_Ds1302_Byte(0x85);
  83   1          prdTime[0] = tTime /16* 10 + tTime % 16;
  84   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    252    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
