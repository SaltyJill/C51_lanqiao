C51 COMPILER V9.52.0.0   DRIVER                                                            04/03/2025 13:05:16 PAGE 1   


C51 COMPILER V9.52.0.0, COMPILATION OF MODULE DRIVER
OBJECT MODULE PLACED IN driver.OBJ
COMPILER INVOKED BY: D:\por-tool\Keil\C51\BIN\C51.EXE driver.c BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          #include "driver.h"
   2          extern volatile u32 T1_1MS; 
   3          void LED_Disp(u8 Lout)
   4          {
   5   1        P0=~Lout;
   6   1        P2=(P2&0x1F)|0x80;
   7   1        P2&=0x1F;
   8   1      }
   9          void DEV_Cls(void)
  10          {
  11   1        P0=0xFF;
  12   1        P2=(P2&0x1F)|0x80;
  13   1        P2&=0x1F;
  14   1        
  15   1        P0=0x00;
  16   1        P2=(P2&0x1F)|0xA0;
  17   1        P2&=0x1F;
  18   1      }
  19          void T1_Int(void)
  20          {
  21   1        TMOD&=0x0F;
  22   1        AUXR&=~(1<<6);
  23   1        TH1=0xFC;
  24   1        TL1=0x18;
  25   1        TF1=0;
  26   1        EA=1;
  27   1        ET1=1;
  28   1        TR1=1;
  29   1      }
  30          void T0_Int(void)
  31          {
  32   1        TMOD|=0x40;
  33   1        AUXR&=~(1<<7);
  34   1        TH0=0x00;
  35   1        TL0=0x00;
  36   1        TF0=0;
  37   1        TR0=1;
  38   1      }
  39          void SEG_Tran(u8 *pstr,u8 *pcod){
  40   1        u8 i,j;
  41   1        for(i=0,j=0;j<8;i++,j++){
  42   2          switch(*(pstr+i)){
  43   3            case '0':
  44   3              *(pcod+j)=0xC0;
  45   3              break;
  46   3            case '1':
  47   3              *(pcod+j)=0xf9;
  48   3              break;
  49   3            case '2':
  50   3              *(pcod+j)=0xa4;
  51   3              break;
  52   3            case '3':
  53   3              *(pcod+j)=0xb0;
  54   3              break;
  55   3            case '4':
C51 COMPILER V9.52.0.0   DRIVER                                                            04/03/2025 13:05:16 PAGE 2   

  56   3              *(pcod+j)=0x99;
  57   3              break;
  58   3            case '5':
  59   3              *(pcod+j)=0x92;
  60   3              break;
  61   3            case '6':
  62   3              *(pcod+j)=0x82;
  63   3              break;
  64   3            case '7':
  65   3              *(pcod+j)=0xf8;
  66   3              break;
  67   3            case '8':
  68   3              *(pcod+j)=0x80;
  69   3              break;
  70   3            case '9':
  71   3              *(pcod+j)=0x90;
  72   3              break;
  73   3            case 'F':
  74   3              *(pcod+j)=0x8e;
  75   3              break;
  76   3            case 'N':
  77   3              *(pcod+j)=0xC8;
  78   3              break;
  79   3            case 'U':
  80   3              *(pcod+j)=0xC1;
  81   3              break;
  82   3            case '-':
  83   3              *(pcod+j)=0xBF;
  84   3              break;
  85   3            case '.':
  86   3              if(j>0){
  87   4                j--;
  88   4              }
  89   3              *(pcod+j)&=0x7F;
  90   3              break;
  91   3            default:
  92   3              *(pcod+j)=0xFF;
  93   3              break;
  94   3      }
  95   2      }
  96   1      }
  97          void SEG_Disp(u8 *pcod,u8 poci){
  98   1        P0=0xFF;
  99   1        P2=(P2&0x1F)|0xE0;
 100   1        P2&=0x1F;
 101   1        
 102   1        P0=(u8)(1<<poci);
 103   1        P2=(P2&0x1F)|0xC0;
 104   1        P2&=0x1F;
 105   1        
 106   1        P0=*(pcod+poci);
 107   1        P2=(P2&0x1F)|0xE0;
 108   1        P2&=0x1F;
 109   1      }
 110          void Delay(u8 Time){
 111   1        u32 DTime;
 112   1        DTime=T1_1MS;
 113   1        while(T1_1MS-DTime<Time);
 114   1      }
 115          u8 KEY_Independ(void){
 116   1        u8 RD1,RD2;
 117   1        u8 btn=0;
C51 COMPILER V9.52.0.0   DRIVER                                                            04/03/2025 13:05:16 PAGE 3   

 118   1        RD1=(P3&0x0F);
 119   1        if(RD1==0x0F)return 0;
 120   1        Delay(20);
 121   1        RD2=(P3&0x0F);
 122   1        if(RD1!=RD2)return 0;
 123   1          switch (~RD2){
 124   2            case 0x08:
 125   2              btn=4;
 126   2            break;
 127   2            case 0x04:
 128   2              btn=5;
 129   2            break;
 130   2            case 0x02:
 131   2              btn=6;
 132   2            break;
 133   2            case 0x01:
 134   2              btn=7;
 135   2            break;
 136   2            default:
 137   2              btn=0;
 138   2            break;
 139   2      }
 140   1       return btn;
 141   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    642    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----      15
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
